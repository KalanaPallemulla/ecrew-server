let Salon,fs,Location;_7a6‍.x([["addSalon",()=>addSalon],["getSalon",()=>getSalon],["addLocation",()=>addLocation],["getLocations",()=>getLocations],["getSingleSalon",()=>getSingleSalon],["removeSalon",()=>removeSalon],["updateSalon",()=>updateSalon],["active",()=>active],["deactivate",()=>deactivate],["getSalonBySearch",()=>getSalonBySearch]]);_7a6‍.w("../models/Salon",[["default",["Salon"],function(v){Salon=v}]]);_7a6‍.w("fs",[["default",["fs"],function(v){fs=v}]]);_7a6‍.w("../models/Location",[["default",["Location"],function(v){Location=v}]]);



       const addSalon = async (req, res) => {
  // console.log("MMMMM");
  try {
    const fields = req.fields;
    const files = req.files;
    // console.log(files.image);

    // console.log(fields);

    const { name, location, contact, openTime, closeTime, address } = fields;

    //Validations
    if (!name) {
      return res.status(400).json({ msg: "Name is required" });
    }
    if (!location) {
      return res.status(400).json({ msg: "Location is required" });
    }
    {
      if (!contact) return res.status(400).json({ msg: "Contact is required" });
    }
    if (!openTime) {
      return res.status(400).send({ msg: "Open Time is required" });
    }
    if (!closeTime) {
      return res.status(400).send({ msg: "Close Time is required" });
    }
    if (!address) {
      return res.status(400).send({ msg: "Address is required" });
    }

    // if (!features) return res.status(400).send({ msg: "Features is required" });

    let salon = new Salon(fields);

    if (files.image) {
      salon.images.data = fs.readFileSync(files.image.path);
      salon.images.contentType = files.image.type;
    }

    _7a6‍.g.console.log(fields.salonSubType);
    let array = fields.salonSubType.split(",");
    _7a6‍.g.console.log(array);
    salon.salonSubType = array;

    _7a6‍.g.console.log(salon);

    salon.save((err, result) => {
      if (err) {
        _7a6‍.g.console.log("Saving salon error =>", err);
        res.status(400).json(err);
      }
      // res.send({ msg: "Salon Added" });
      res.send(result);
    });
  } catch (err) {
    _7a6‍.g.console.log(err);
    res.status(400).json({
      msg: err.message,
    });
  }
};

       const getSalon = async (req, res) => {
  try {
    let salon = await Salon.find()
      .select("-images.data")
      .sort("-createdAt")
      .exec();
    if (salon.length == 0)
      return res.status(400).send({ msg: " There are no salons" });
    res.json(salon);
  } catch (err) {
    _7a6‍.g.console.log(err);
    res.status(400).json({
      msg: err.message,
    });
  }
};

       const addLocation = async (req, res) => {
  let loc = req.body;
  const { addLocation } = loc;
  let name = addLocation;
  let location = await Location.findOne({ name });
  _7a6‍.g.console.log(location);

  if (!location) {
    if (name == "") return res.status(400).send("Name cannot be empty");
    location = new Location({ name });

    await location.save((err, result) => {
      if (err) return res.status(400).send({ err });
      return res.status(200).json(result);
    });
  } else {
    return res.status(400).send({ msg: "Location already added" });
  }

  // location = new Location(loc);

  // await location.save((err, result) => {
  //   if (err) return res.status(400).send({ err });
  //   return res.status(200).json(result);
  // });
};

       const getLocations = async (req, res) => {
  try {
    let location = await Location.find().exec();
    if (!location) {
      return res.status(400).send("There is no locations");
    }

    res.json(location);
  } catch (error) {
    _7a6‍.g.console.log(error);
    return res.status(400).send("Server Error");
  }
};

       const getSingleSalon = async (req, res) => {
  try {
    let salon = await Salon.findById(req.params.id);

    if (!salon) {
      return res.status(400).send("There is no salon for this id");
    }

    res.json(salon);
  } catch (error) {
    _7a6‍.g.console.log(error);
    return res.status(400).send("Server Error");
  }
};

       const removeSalon = async (req, res) => {
  try {
    let salon = await Salon.findById(req.params.id);
    if (salon) {
      await Salon.findByIdAndDelete(req.params.id);
      res.send("Salon Deleted");
    } else {
      return res.status(400).send("There is no salon for this id");
    }
  } catch (error) {
    _7a6‍.g.console.log(error);
    return res.status(400).send("Server Error");
  }
};

       const updateSalon = async (req, res) => {
  try {
    let fields = req.fields;

    let data = { ...fields };

    let update = await Salon.findByIdAndUpdate(req.params.id, data, {
      new: true,
    }).exec();
    res.json("Updated");
  } catch (error) {
    _7a6‍.g.console.log(error);
    return res.status(400).send("Server Error");
  }
};

       const active = async (req, res) => {
  try {
    let salon = await Salon.findByIdAndUpdate(req.params.id, {
      active: 1,
    });

    res.send("active");
  } catch (error) {
    _7a6‍.g.console.log(error);
    return res.status(400).send("Server Error");
  }
};

       const deactivate = async (req, res) => {
  try {
    let salon = await Salon.findByIdAndUpdate(req.params.id, {
      active: 0,
    });

    res.send("deactivated");
  } catch (error) {
    _7a6‍.g.console.log(error);
    return res.status(400).send("Server Error");
  }
};

       const getSalonBySearch = async (req, res) => {
  res.send("hi");
};
